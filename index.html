<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kong Auth0 Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1>Kong Auth0 Demo</h1>
        
        <div class="card mb-4">
            <div class="card-header">
                <h2>Authentication Status</h2>
            </div>
            <div class="card-body">
                <div id="login-status" class="mb-3">Checking login status...</div>
                <div id="auth-buttons">
                    <a href="#" id="login-btn" class="btn btn-success">Log In</a>
                    <a href="#" id="logout-btn" class="btn btn-danger d-none">Log Out</a>
                </div>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header">
                <h2>Public API</h2>
            </div>
            <div class="card-body">
                <button id="public-btn" class="btn btn-primary mb-3">Fetch Public Data</button>
                <pre id="public-result" class="bg-light p-3 border rounded">Results will appear here...</pre>
            </div>
        </div>
        
        <div class="card mb-4">
            <div class="card-header">
                <h2>Protected API</h2>
            </div>
            <div class="card-body">
                <button id="protected-btn" class="btn btn-primary mb-3">Fetch Protected Data</button>
                <pre id="protected-result" class="bg-light p-3 border rounded">Results will appear here...</pre>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <h2>User Profile</h2>
            </div>
            <div class="card-body">
                <pre id="user-profile" class="bg-light p-3 border rounded">Log in to see user profile</pre>
            </div>
        </div>
    </div>

    <script>
    $(document).ready(function() {
        // Kong Gateway URL - replace with your actual URL
        const KONG_URL = "https://kong-4660be7380uskbblx.kongcloud.dev";
        
        // Check login status
        function checkLoginStatus() {
            $.ajax({
                url: KONG_URL + '/userinfo',
                type: 'GET',
                xhrFields: {
                    withCredentials: true
                },
                success: function(userInfo) {
                    $('#login-status').text('Logged in as: ' + (userInfo.name || userInfo.email || 'User'));
                    $('#login-btn').addClass('d-none');
                    $('#logout-btn').removeClass('d-none');
                    $('#user-profile').text(JSON.stringify(userInfo, null, 2));
                },
                error: function() {
                    $('#login-status').text('Not logged in');
                    $('#login-btn').removeClass('d-none');
                    $('#logout-btn').addClass('d-none');
                    $('#user-profile').text('Log in to see user profile');
                }
            });
        }
        
        // Login button
        $('#login-btn').click(function(e) {
            e.preventDefault();
            window.location.href = KONG_URL + '/login?redirect_uri=' + encodeURIComponent(window.location.href);
        });
        
        // Logout button
        $('#logout-btn').click(function(e) {
            e.preventDefault();
            $.ajax({
                url: KONG_URL + '/logout',
                type: 'GET',
                xhrFields: {
                    withCredentials: true
                },
                success: function() {
                    window.location.reload();
                },
                error: function(xhr) {
                    alert('Logout failed: ' + xhr.statusText);
                }
            });
        });
        
        // Public API button
        $('#public-btn').click(function() {
            $('#public-result').text('Loading...');
            $.ajax({
                url: KONG_URL + '/api/public',
                type: 'GET',
                xhrFields: {
                    withCredentials: true
                },
                success: function(data) {
                    $('#public-result').text(JSON.stringify(data, null, 2));
                },
                error: function(xhr) {
                    $('#public-result').text('Error: ' + xhr.status + ' ' + xhr.statusText);
                }
            });
        });
        
        // Protected API button
        $('#protected-btn').click(function() {
            $('#protected-result').text('Loading...');
            $.ajax({
                url: KONG_URL + '/api/private',
                type: 'GET',
                xhrFields: {
                    withCredentials: true
                },
                success: function(data) {
                    $('#protected-result').text(JSON.stringify(data, null, 2));
                },
                error: function(xhr) {
                    if (xhr.status === 401 || xhr.status === 403) {
                        window.location.href = KONG_URL + '/login?redirect_uri=' + encodeURIComponent(window.location.href);
                    } else {
                        $('#protected-result').text('Error: ' + xhr.status + ' ' + xhr.statusText);
                    }
                }
            });
        });
        
        // Check login status on page load
        checkLoginStatus();
    });
    </script>
</body>
</html>
